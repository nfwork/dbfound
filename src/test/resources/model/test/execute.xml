<?xml version="1.0" encoding="UTF-8"?>
<model xmlns="http://dbfound.googlecode.com/model" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://dbfound.googlecode.com/model https://raw.githubusercontent.com/nfwork/dbfound/master/tags/model.xsd">

    <execute>
        <param name="role_id" dataType="number" ioType="out" />
        <param name="user_id" dataType="varchar" ioType="out" />
        <param name="user_name" dataType="varchar" ioType="out" />
        <param name="fields_size" dataType="number" sourcePath="fields.size" value="0" />
		<sqls>
			<collisionSql where="${@role} is null" message="role不能为空" code="10010" />
            <querySql>
				select ${@role} as role_id
			</querySql>
            <whenSql when="${@fields_size} > 0">
                <querySql>
                    select
                    <sqlPart type="for" sourcePath="fields">
                        ${@value} as #{@code}
                    </sqlPart>
                </querySql>
                <executeSql>
                    select
                    <sqlPart type="for" sourcePath="fields">
                        ${@value} as #{@code}
                    </sqlPart>
                </executeSql>
			</whenSql>
		</sqls>
	</execute>

    <execute name="ifPart">
        <param name="user_id" dataType="varchar" ioType="both" />
        <param name="user_name" dataType="varchar" ioType="both" />
		<sqls>
            <querySql>
                select
                <sqlTrim>
                    <sqlPart type="if" sourcePath="user_id">
                        1 as user_id,
                    </sqlPart>
                    <sqlPart type="if" sourcePath="user_name">
                        'lily' as user_name,
                    </sqlPart>
                    <sqlPart type="if" condition="${@user_code} is not null">
                        '10010' as user_code,
                    </sqlPart>
                </sqlTrim>
            </querySql>
			<executeSql>
                select
                <sqlTrim>
                    <sqlPart type="if" sourcePath="user_id">
                        1 as user_id,
                    </sqlPart>
                    <sqlPart type="if" sourcePath="user_name">
                        'lily' as user_name,
                    </sqlPart>
                    <sqlPart type="if" condition="${@user_code} is not null">
                        '10010' as user_code,
                    </sqlPart>
			    </sqlTrim>
			</executeSql>
            <executeSql>
                select
                    <sqlPart type="if" sourcePath="user_id" autoClearComma="true">
                        1 as user_id,
                    </sqlPart>
                    <sqlPart type="if" sourcePath="user_name" autoClearComma="true">
                        'lily' as user_name,
                    </sqlPart>
                    <sqlPart type="if" condition="${@user_code} is not null" autoClearComma="true">
                        '10010' as user_code,
                    </sqlPart>
            </executeSql>
		</sqls>
	</execute>

    <execute name="batchSql">
        <param name="user_id_0" ioType="out" scope="outParam" />
        <param name="user_id_1" ioType="out" scope="outParam" />
		<sqls>
			<batchSql sourcePath="users" item="user_id" index="index">
				<querySql>
					select ${@user_id} as user_id_#{@index}
				</querySql>
			</batchSql>
		</sqls>
	</execute>

    <execute name="batchExecuteSql">
        <sqls>
            <batchExecuteSql sourcePath="users" item="user_id" index="index">
                select
                    #BATCH_TEMPLATE_BEGIN#
                    ${@user_id} as user_id_#{@index}
                    #BATCH_TEMPLATE_END#
			</batchExecuteSql>
        </sqls>
    </execute>

    <execute name="adapter" adapter="dbfound.test.adapter.ExecuteTestAdapter">
        <sqls>
            <querySql>
				select 1 as user_id
			</querySql>
        </sqls>
    </execute>

</model>